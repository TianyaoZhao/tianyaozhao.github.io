# PUBG

虚幻引擎5.1.3

**游戏文件目录**

Assets

Blueprents

Characters

BlendSpace 混合空间 （存放游戏角色动画）

AimOffets 瞄准偏移 （存放瞄准偏移动画）

Montage 蒙太奇 （存放角色动画蒙太奇）

MyAnimBlueprint 动画蓝图 （控制动画）

Gameplay 游戏框架

Datas 静态数据文件

DataTable 数据表文件

TableStructure Table用到的Structure文件

Items 所有物品对象

Maps

### 创建任务与资源介绍

![](./.assets/image-20240302211720899.png)

导入素材

![](./.assets/image-20240302212248775.png)

导入素材以后重启引擎，才能正常显示导入的内容

![](./.assets/image-20240302212830107.png)

素材介绍

![](./.assets/image-20240302213028568.png)

Assets

`Animations`：动画文件

`Audio`：音频文件

`Font`：字体文件

`Human`：衣服材质

`Icons`：图标文件

`Maps`：搭建场景所需要的资源

`Others`：无法确定分类的文件（空投箱材质）

`Outline`：描边工具，高亮材质

`Parachute`：降落伞资源

`Particles`：所有粒子特效相关资源

`Prop`：所有物品的3d相关资源

`Safezone`：安全区资源(毒圈)

`UI`：制作UI需要的相关图片

`Vehicle`：飞机相关的资源

`Weapons`：武器相关资源

Maps

相应的地图，使用Level_Battle(正式地图)

![image-20240302213929610](./.assets/image-20240302213929610.png)

![](./.assets/image-20240302214150787.png)

在测试地图中做项目（测试），最后移植到正式的地图上

![image-20240302214345145](./.assets/image-20240302214345145.png)

![](./.assets/image-20240302214457995.png)

### 了解编辑器的基本功能

### 了解重要的元素

虚幻元素都有一个根类，Object，几乎所有的功能都继承这个纯粹的类

### GamePlay框架

![image-20240302220301464](./.assets/image-20240302220301464.png)

选择GameMode：游戏的基础规则存在GameMode中，不需要关注如何生成，有六个属性

`Pawn`：傀儡，玩家控制的人物，在游戏中一直存在

`HUD`：ui管理器

`游戏状态类`：在一场游戏中的得分都存在游戏状态中

`玩家状态类`：玩家状态，血条等

`旁观者类`：死后视角（死亡回放等）

`玩家控制类`

![image-20240302220637697](./.assets/image-20240302220637697.png)

![image-20240302220434637](./.assets/image-20240302220434637.png)

### 项目设置

新建Blueprents文件夹/Characters 和 Gameplay

`Characters`：与角色有关的设置的蓝图

`Gameplay`：游戏框架

![](./.assets/image-20240302221216129.png)

游戏模式基础GameModeBase

玩家控制器PlayerController  前后左右相应时间

游戏状态基础GameStateBase 存储当前剩余玩家数量以及安全区信息

HUD 存储UI，当前玩家的状态生命值UI等等

玩家状态PlayerState

![image-20240302222423584](./.assets/image-20240302222423584.png)

角色

![image-20240302222440420](./.assets/image-20240302222440420.png)

修改GameMode类的属性为刚刚新建的几个类

![image-20240302223047206](./.assets/image-20240302223047206.png)

项目设置更改GameMode、更改游戏地图

![image-20240302223224314](./.assets/image-20240302223224314.png)

世界场景设置改为MyGameMode

![image-20240302223338606](./.assets/image-20240302223338606.png)

创建游戏实例GameInstance 整个应用程序从启动到结束一直存在，类似与场景切换

![image-20240302223544859](./.assets/image-20240302223544859.png)

修改为MyGameInstance

![image-20240302223707126](./.assets/image-20240302223707126.png)

**操作映射和轴映射**-引擎输入绑定按键

![image-20240302224128596](./.assets/image-20240302224128596.png)

操作映射：响应每一次按键的**抬起和按下**，都会收到一次响应的事件，比如按下是前进，抬起就不会前进了

轴映射：不管键盘是否按下，都会一直收到一个事件，这个事件有个参数，可以判断是否按下

![image-20240303084428871](./.assets/image-20240303084428871.png)

打开关卡蓝图

![image-20240303085248832](./.assets/image-20240303085248832.png)

![image-20240303085318131](./.assets/image-20240303085318131.png)

观察到按下A时，打印200，松开A时打印100

![image-20240303085459304](./.assets/image-20240303085459304.png)

![image-20240303085533903](./.assets/image-20240303085533903.png)

观察到按下S打印1，松开S打印0

==2024.3.2==

### 混合空间介绍

近裁剪面：场景视口中摄像机距离物体近，物体被裁剪

引擎-一般设置-设置-近剪切平面-数值改为1-重启引擎

影响后续武器瞄准功能

![image-20240303085947255](./.assets/image-20240303085947255.png)

混合空间：一种图表，可以放入任意数量的动画混合，根据二维图表的位置索引，切换不同的动画

**例子**

点击一维动画

![image-20240303090535719](./.assets/image-20240303090535719.png)

选择骨骼

![](./.assets/image-20240303090619314.png)

![image-20240303090713507](./.assets/image-20240303090713507.png)

修改动画

![image-20240303091042637](./.assets/image-20240303091042637.png)

修改speed为0.0发现当站着不动的时候速度是0

![image-20240303091257884](./.assets/image-20240303091257884.png)

类似的将as_normal_stand_walk_fwd 的speed改为50 as_normal_stand_run_fwd 改为100

![image-20240303091444133](./.assets/image-20240303091444133.png)

按住ctrl拖动绿色的标记，可以运动

**创建二维混合空间，添加骨骼**

![image-20240303091822453](./.assets/image-20240303091822453.png)

![image-20240303092306051](./.assets/image-20240303092306051.png)

向前走改为向左走

![image-20240303092224999](./.assets/image-20240303092224999.png)

### 创建非持枪站姿移动混合空间

创建混合空间文件夹，所有的动作动画都在这个混合空间中

![image-20240303092454450](./.assets/image-20240303092454450.png)

BS_Normal_Stand 混合空间  非持枪 站立

![image-20240303092643194](./.assets/image-20240303092643194.png)

![image-20240303094927890](./.assets/image-20240303094927890.png)

**设置参数**

![image-20240303095211517](./.assets/image-20240303095211517.png)

**水平轴**分成-180 -135 -90 -45 0 45 90 135 180

后 左后 左 左前 前 右前 右 右后 后

**纵轴**分成 0 156 （364 468） 625

站着不动 走 （慢跑） 跑

### 创建非持枪蹲姿移动混合空间

![image-20240303100733239](./.assets/image-20240303100733239.png)

### 创建非持枪趴姿移动混合空间

![image-20240303102144078](./.assets/image-20240303102144078.png)

### 创建持枪站姿移动混合空间

![image-20240303114244337](./.assets/image-20240303114244337.png)

### 创建持枪蹲姿移动混合空间

![image-20240303114935372](./.assets/image-20240303114935372.png)

### 创建持枪趴姿移动混合空间

![image-20240303120002614](./.assets/image-20240303120002614.png)

### 创建持枪站姿且瞄准移动混合空间

![image-20240303120552283](./.assets/image-20240303120552283.png)

### 创建持枪蹲姿且瞄准移动混合空间

![image-20240303120626709](./.assets/image-20240303120626709.png)

### 创建跳伞混合空间

![image-20240303120707980](./.assets/image-20240303120707980.png)

### 瞄准偏移介绍

简单理解，让角色的上半身和下半身分为两个部分，以确保上半身不会影响上半身

资源-存储一系列可混合的姿势，以帮助角色瞄准武器，在动画过程中，瞄准偏移的结果与其他的动作混合在一起，从而使角色从各个方向看起来都很平滑，创建多方向瞄准武器混合结构。

**创建二维瞄准偏移**

![image-20240303172743597](./.assets/image-20240303172743597.png)

Yaw（偏航）：表示角色Y轴的旋转值

Pitch（俯仰）：表示角色X轴的旋转值

![](./.assets/image-20240303173057367.png)

![image-20240303173222818](./.assets/image-20240303173222818.png)

**设置角色预览姿势**

![image-20240303173347049](./.assets/image-20240303173347049.png)

**设置好后，可以控制角色实现低头**

![image-20240303173655730](./.assets/image-20240303173655730.png)

### 创建非持枪站立瞄准偏移

1. 创建非持枪站立瞄准偏移

   ![image-20240303174148059](./.assets/image-20240303174148059.png)
2. 修改水平坐标和垂直坐标

   ![image-20240303174112553](./.assets/image-20240303174112553.png)
3. 修改基础预览姿势

   ![image-20240303174220153](./.assets/image-20240303174220153.png)
4. 添加向上下左右看的姿势

   实现了上下左右看的效果

   ![image-20240303174540376](./.assets/image-20240303174540376.png)

### 创建非持枪蹲姿瞄准偏移

![image-20240303175117119](./.assets/image-20240303175117119.png)

### 创建持枪和持枪瞄准 站立瞄准偏移

**持枪站立 瞄准偏移**

![image-20240303175310459](./.assets/image-20240303175310459.png)

**持枪瞄准站立  瞄准偏移**

![image-20240303175430128](./.assets/image-20240303175430128.png)

### 创建持枪和持枪瞄准 蹲姿瞄准偏移

**持枪蹲姿 瞄准偏移**

![image-20240303175622521](./.assets/image-20240303175622521.png)

**持枪瞄准蹲姿  瞄准偏移**

![image-20240303175647524](./.assets/image-20240303175647524.png)

### 动画蓝图介绍

动画蓝图是一种可视化的脚本，用于创建和控制复杂的动画行为，一种比较特殊的蓝图，控制骨骼网格体的动画效果，控制所有的动画，什么时候播放，播放什么动画

1. 创建动画蓝图，骨骼选择famle

   ![image-20240303180010941](./.assets/image-20240303180010941.png)
2. 事件图表

   ![image-20240303180404864](./.assets/image-20240303180404864.png)

   事件蓝图更新图表每帧都会执行，实时更新角色的状态（速度、方向）
3. 动画图表

   用于构建姿势的逻辑，评估当前帧骨骼网络的最终姿势，可以对动画进行混合，还可以直接修改骨骼的位置缩放以及旋转

   ![image-20240303180913812](./.assets/image-20240303180913812.png)
4. 状态机

   用于构建基于状态的逻辑，通常是用于角色的移动，是在动画蓝图中构建的模块化系统，用来定义动画的播放状态和播放时机，状态的关联

   ![image-20240303181035502](./.assets/image-20240303181035502.png)

### 创建动画蓝图相关变量

1. 创建动画蓝图

   ![image-20240303183613659](./.assets/image-20240303183613659.png)
2. 创建变量Speed和Direction，代表角色在地面的移动速度，单位是cm/s，控制前面混合空间的速度值和方向

   ![image-20240303182222227](./.assets/image-20240303182222227.png)
3. 创建Pitch和Yaw，控制前面瞄准偏移，抬头低头 左看右看

   ![image-20240303182442175](./.assets/image-20240303182442175.png)
4. 创建ForwardValue和SidewaysVelocity 控制在空中的俯仰以及横向移动的速度

   ![image-20240303182721077](./.assets/image-20240303182721077-1709461641585-1.png)
5. 创建IsJumping和IsCrouching 判断角色是否处于跳跃和蹲的状态

   IsJumping：是否处于跳跃状态

   IsCrouching：是否处于蹲的状态

   IsProne：是否处于趴的状态

   IsInAir：是否在空中

   IsHoldWeapon：是否持有武器

   IsFreeFalling：是否自由落体状态

   IsUmbrellaOpened：是否降落伞打开了

   IsDead：角色是否死亡

   ![image-20240303183004202](./.assets/image-20240303183004202.png)


### 设置状态机非持枪状态

1. 打开MyAnimBlueprint创建状态机

   ![image-20240303184657252](./.assets/image-20240303184657252.png)
2. 拖入站立混合空间到状态机中

   ![image-20240303184833847](./.assets/image-20240303184833847.png)
3. 双击站立状态混合空间

   将之前设置的速度和方向变量赋值给他

   ![image-20240303185041932](./.assets/image-20240303185041932.png)
4. 进入状态机，连接并编译，发现角色处于待机动画

   ![image-20240303185147611](./.assets/image-20240303185147611.png)
5. 修改速度值为160，发现角色处于运动状态，这样可以通过不运行游戏，角色还能看处于运动状态

   ![image-20240303185301097](./.assets/image-20240303185301097.png)
6. 连接从站立到蹲姿，双向箭头表示从站立到蹲姿需要一个什么样的条件

   ![image-20240303185513711](./.assets/image-20240303185513711.png)
7. 双击进入，设置里面的规则

   将布尔变量拖入，从站立到蹲需要IsCrouching为True

   ![image-20240303185638679](./.assets/image-20240303185638679.png)
8. 角色正常切换到蹲姿

   ![image-20240303185833738](./.assets/image-20240303185833738.png)
9. 同样设置从蹲到站的规则

   设置IsCrouching为Fasle，取反的时候为转换为站姿

   ![image-20240303190057695](./.assets/image-20240303190057695.png)
10. 发现人物站起来了

    ![image-20240303190138112](./.assets/image-20240303190138112.png)
11. 连接从站立到趴姿（直接连接有些诡异，需要添加过渡动画）

    ![image-20240303190455308](./.assets/image-20240303190455308.png)
12. 设置从站立到过渡动画的规则

    ![image-20240303190558640](./.assets/image-20240303190558640.png)
13. 设置从过渡动画到趴的规则

    添加获取相关剩余动画时间

    ![image-20240303190705435](./.assets/image-20240303190705435.png)

    设置时间小于等于0.3秒

    ![image-20240303190825167](./.assets/image-20240303190825167.png)

    当过渡动画播放时间剩余0.3s就切换到趴姿动画
14. 同理添加趴下到站立的过渡动画

    **只有趴和蹲都是False才会切换到站立**，如果蹲下是True，**说明要从趴下切换到蹲下**

    ![image-20240303191356494](./.assets/image-20240303191356494.png)

    过渡动画播放小于等于0.3s才会切换

    ![image-20240303191603965](./.assets/image-20240303191603965.png)

    ![image-20240303191644266](./.assets/image-20240303191644266.png)
15. 设置蹲姿到趴姿

    趴姿为True

    ![image-20240303192139800](./.assets/image-20240303192139800.png)

    ![image-20240303192301615](./.assets/image-20240303192301615.png)
16. 设置趴姿到蹲姿

    趴为Fasle 蹲为True时

    ![image-20240303192427577](./.assets/image-20240303192427577.png)

![image-20240303192532053](./.assets/image-20240303192532053.png)

非持枪状态 状态机完成

![image-20240303192715974](./.assets/image-20240303192715974.png)

### 设置状态机持枪状态

1. 非持枪站立到持枪站立

   IsHoldWeapon为true

   ![image-20240303194101910](./.assets/image-20240303194101910.png)
2. 持枪站立到持枪蹲姿

   IsCrouching为true

   ![image-20240303194425540](./.assets/image-20240303194425540.png)
3. 持枪站立到持枪趴姿（过渡动画）

   ![image-20240303201143005](./.assets/image-20240303201143005.png)
4. 持枪蹲姿到持枪趴姿（过渡动画）

   ![image-20240303201159453](./.assets/image-20240303201159453.png)

   **另外我发现，非持枪站姿到蹲姿是有过渡动画的，因此我又加上了过渡动画**

   ![image-20240303201246024](./.assets/image-20240303201246024.png)

### 设置非持枪状态与持枪状态的衔接

连接持枪蹲与非持枪蹲

![image-20240303201630072](./.assets/image-20240303201630072.png)

连接持枪趴与非持枪趴

![](./.assets/image-20240303201922983.png)

设置完毕

![image-20240303202013864](./.assets/image-20240303202013864.png)

### 设置状态机持枪瞄准状态

**疏忽,要把变量连接一下**

![image-20240303202325163](./.assets/image-20240303202325163.png)

1. 设置持枪站立与持枪站立瞄准的连接

   ![image-20240303202932209](./.assets/image-20240303202932209.png)
2. 设置持枪蹲与持枪蹲瞄准的连接

   ![image-20240303203323180](./.assets/image-20240303203323180.png)
3. 设置持枪蹲瞄准与持枪站瞄准的连接

   ![image-20240303203333779](./.assets/image-20240303203333779.png)

### 设置状态机跳伞状态

1. 非持枪站立到跳伞

   IsInAir为true 在空中

   IsInFreeFalling为true 自由落体

   ![image-20240303204712362](./.assets/image-20240303204712362.png)
2. 从跳伞到开伞

   IsUmbrellaOpened为true 开伞状态

   ![image-20240303204720336](./.assets/image-20240303204720336.png)
3. 从开伞到开伞滑行

   开伞画面小于等于0.3

   ![image-20240303204728273](./.assets/image-20240303204728273.png)
4. 滑行动作到落地动作

   IsInAir为false

   ![image-20240303205107464](./.assets/image-20240303205107464.png)
5. 从落地到非持枪站立

   落地的动作剩余时间小于等于0.3

   ![image-20240303205150020](./.assets/image-20240303205150020.png)

   完成

   ![image-20240303205419535](./.assets/image-20240303205419535.png)

### 设置状态机跳跃状态

![image-20240303213301048](./.assets/image-20240303213301048.png)

1. 非持枪状态到跳跃

   IsInAir为true
2. 从开始跳到跳循环

   获取开始跳剩余动画时间小于等于0.3
3. 从跳循环到跳结束

   IsInAir为false
4. 从跳跃结束到非持枪站立

   获取跳跃结束的时间小于等于0.3

   IsHoldWeapon为false
5. 连接持枪站立到开始跳（同理）
6. 连接跳跃结束到持枪站立（同理）
7. 连接跳循环到开伞

   判断角色是否处于自由落体的状态

   ![image-20240303213749578](./.assets/image-20240303213749578.png)

   ==2024.3.3==

### 设置状态机死亡状态

1. 创建非持枪站立和持枪站立到死亡

   死亡布尔值isdead为true
2. 创建非持枪蹲姿和持枪蹲姿到死亡
3. 创建非持枪趴姿和持枪趴姿到死亡

   ![image-20240304103438697](./.assets/image-20240304103438697.png)
4. 调整死亡动画只播放一次，不需要循环播放

   循环动画，取消勾选

   ![image-20240304103924524](./.assets/image-20240304103924524.png)

### 动画图表逻辑制作

输出姿势是角色实时的形态，状态机实时获取角色的状态，输出角色的各种姿势

![image-20240304104049847](./.assets/image-20240304104049847.png)

1. 断开状态机与输出姿势的连接 ctrl
2. 创建cache，保存状态机提供的姿势，方便后续访问和使用

   ![image-20240304104315197](./.assets/image-20240304104315197.png)

   ![image-20240304104420638](./.assets/image-20240304104420638.png)
3. 窗口打开动画插槽管理器

   ![image-20240304104458004](./.assets/image-20240304104458004.png)
4. 新建插槽UpperBody

   制作蒙太奇动画时需要使用这个插槽 （角色射击和上子弹）

   创建比较复杂的动作，在一些动作里插入一些动作，比如在蹲下的时候插入换弹动作

   ![image-20240304104533572](./.assets/image-20240304104533572.png)
5. 创建Cache，添加插槽，更改为upperbody

   ![image-20240304104826723](./.assets/image-20240304104826723.png)

   ![image-20240304104838067](./.assets/image-20240304104838067.png)
6. 创建新的Cache

   ![image-20240304104958965](./.assets/image-20240304104958965.png)
7. 将瞄准偏移混合到动画中

   拖入瞄准偏移动画

   ![image-20240304110149976](./.assets/image-20240304110149976.png)

   将之前的MontageCache和瞄准偏移连接，并且添加按整形混合姿势，并右键添加七个引脚

   每个引脚对应着一个姿势，因此还需要添加一个MontageCache作为没有瞄准偏移的姿势6+1

   ![image-20240304110932806](./.assets/image-20240304110932806.png)

   ![image-20240304111301533](./.assets/image-20240304111301533.png)
8. 创建一个变量，表示当前处于哪种状态 AimOffset

   ![image-20240304111406628](./.assets/image-20240304111406628.png)

   将变量设置给index

   ![image-20240304111441001](./.assets/image-20240304111441001.png)
9. 再将混合后的姿势创建一个Cache

   ![image-20240304111612709](./.assets/image-20240304111612709.png)
10. 创建每个骨骼的分层混合

    比如蒙太奇和瞄准偏移，它只会影响上半身，因此分层混合不影响下半身

    ![image-20240304112038771](./.assets/image-20240304112038771.png)

    修改设置，添加数组元素

    ![image-20240304112030778](./.assets/image-20240304112030778.png)
11. 添加一个bool变量，判断是否播放蒙太奇动画

    **实现逻辑是：如果此时正在播放蒙太奇动画，那么就将基础动画和蒙太奇动画，按骨骼分层混合输出姿势，否则就是再播放瞄准偏移动画**

    ![image-20240304112414619](./.assets/image-20240304112414619.png)
12. 实现完成

    ![image-20240304112718831](./.assets/image-20240304112718831.png)

    ![image-20240304112732996](./.assets/image-20240304112732996.png)

### 瞄准偏移混合测试

1. 先将变量Yaw和Pitch添加到瞄准偏移混合空间

   ![image-20240304112931587](./.assets/image-20240304112931587.png)
2. **这里遇到了一个小坑，需要退出重进一下才能正常编译动画**
3. 修改类型为2，修改yaw和pitch

   ![image-20240304120856576](./.assets/image-20240304120856576.png)

   ![image-20240304120902233](./.assets/image-20240304120902233.png)

   发现动画流程

   ![image-20240304120912664](./.assets/image-20240304120912664.png)

   ![image-20240304120936129](./.assets/image-20240304120936129.png)
4. 人物为蹲姿且扭头

   ![image-20240304120953056](./.assets/image-20240304120953056.png)
5. 瞄准偏移混合测试完毕

### 在MyCharacter中创建变量

事件图表

![image-20240304121711202](./.assets/image-20240304121711202.png)

事件蓝图更新动画事件：在动画更新时触发

尝试获取Pawn拥有者事件：获取当前的Pawn，在游戏中实际上就是获取当前的MyCharacter

从MyCharacter中获取当前角色的各种状态，然后设置给动画蓝图的变量，改变角色的形态

1. 打开MyCharacter，打开完整的蓝图编辑器

   ![image-20240304122239771](./.assets/image-20240304122239771.png)
2. 创建如下变量并修改对应的变量类型

   ![image-20240304123226789](./.assets/image-20240304123226789.png)

### 设置直接获取的变量

打开事件图表

![image-20240304123659643](./.assets/image-20240304123659643.png)

1. 按照上图连接，并将类型变为纯类型连接

   函数分为纯类型和非纯类型

   ![image-20240304123842860](./.assets/image-20240304123842860.png)
2. 提升为变量并且修改名称

   ![image-20240304124055178](./.assets/image-20240304124055178.png)
3. 添加一个序列节点，方便管理代码

   ![image-20240304124226424](./.assets/image-20240304124226424.png)
4. 图示连接

   ![image-20240304124245024](./.assets/image-20240304124245024.png)
5. 通过MyCharacter设置蒙太奇动画正在播放

   ![image-20240304125014116](./.assets/image-20240304125014116.png)
6. 通过MyCharacter获取变量

   ![image-20240304125214379](./.assets/image-20240304125214379.png)
7. 注释

   ![image-20240304125320931](./.assets/image-20240304125320931.png)
8. ![image-20240304125631333](./.assets/image-20240304125631333.png)

### 设置计算获取的变量

1. 通过计算获取角色的速度值

   ![image-20240304130515722](./.assets/image-20240304130515722.png)
2. 通过计算获取角色的方向值

   ![image-20240304130830572](./.assets/image-20240304130830572.png)
3. 通过计算获取角色的角度

   ![image-20240304131321995](./.assets/image-20240304131321995.png)

### 设置动画瞄准偏移变量

就是前面的那个动画数组0-6，决定播放哪个动画

1. 设置空中动画相关变量

   ![image-20240304132222052](./.assets/image-20240304132222052.png)
2. 如果是在空中或者是趴姿，就不需要设置瞄准动画偏移，直接是0就可以

   ![image-20240304133737268](./.assets/image-20240304133737268.png)


### 动画蒙太奇简介

将动画合并到一个资产并通过蓝图控制播放

1. 创建动画蒙太奇

   ![image-20240304134517464](./.assets/image-20240304134517464.png)
2. 拖入动画，点击播放

   ![image-20240304134751249](./.assets/image-20240304134751249.png)
3. 我们只想更改上半身，因此修改插槽为upperboday

   ![image-20240304135043542](./.assets/image-20240304135043542.png)
4. 发现动画不播放了，关掉重新进入即可
5. 点击右键，新建一个蒙太奇动画片段

   ![image-20240304135322166](./.assets/image-20240304135322166.png)
6. S1将动画分割为两部分

   ![image-20240304135452293](./.assets/image-20240304135452293.png)
7. 播放设置

   ![image-20240304135543604](./.assets/image-20240304135543604.png)
8. 在1轨道，右键，可以新建一个通知

   ![image-20240304135746522](./.assets/image-20240304135746522.png)

   当运行到这的时候，在动画蓝图中能监听到这个通知

### 装备步枪动画蒙太奇

1. 新建文件夹

   ![image-20240304140002419](./.assets/image-20240304140002419.png)
2. 找到站姿更换武器的动画序列，右键创建动画蒙太奇

   ![image-20240304141331483](./.assets/image-20240304141331483.png)
3. 更改插槽名称，保存并重新进入

   ![image-20240304141446283](./.assets/image-20240304141446283.png)
4. 新建通知，设置到15帧和24帧

   ![image-20240304141804492](./.assets/image-20240304141804492.png)

   ![image-20240304141854351](./.assets/image-20240304141854351.png)

   ![image-20240304142346471](./.assets/image-20240304142346471.png)
5. 在事件图表中添加动画响应

   事件图表添加

   ![image-20240304142601265](./.assets/image-20240304142601265.png)
6. 创建事件分发器，调用连接

   ![image-20240304142738230](./.assets/image-20240304142738230.png)

   ![image-20240304142742183](./.assets/image-20240304142742183.png)

   ![image-20240304142854375](./.assets/image-20240304142854375.png)
7. 将蒙太奇文件移动到创建的文件夹中
8. 创建蹲姿趴姿切换武器蒙太奇

   ![image-20240304143144314](./.assets/image-20240304143144314.png)

   ![image-20240304143524213](./.assets/image-20240304143524213.png)
9. 修改事件图表

   ![image-20240304143603486](./.assets/image-20240304143603486.png)

### 收回步枪动画蒙太奇

以上同理

站姿收回武器

![image-20240304143955938](./.assets/image-20240304143955938.png)

蹲姿收回武器

![image-20240304144023380](./.assets/image-20240304144023380.png)

趴姿收回武器

![image-20240304144046336](./.assets/image-20240304144046336.png)

事件图表

![image-20240304144349066](./.assets/image-20240304144349066.png)

### 换弹夹和换子弹动画蒙太奇

站立换子弹

![image-20240304144728215](./.assets/image-20240304144728215.png)

趴姿换子弹

![image-20240304144958945](./.assets/image-20240304144958945.png)

事件图表

![image-20240304145049609](./.assets/image-20240304145049609.png)

### 射击相关动画蒙太奇

站姿射击蒙太奇

![image-20240304145154486](./.assets/image-20240304145154486.png)

蹲姿射击蒙太奇

![image-20240304145324696](./.assets/image-20240304145324696.png)

趴姿射击蒙太奇

![image-20240304145313419](./.assets/image-20240304145313419.png)


事件图表

![image-20240304145514706](./.assets/image-20240304145514706.png)

### 使用物品相关动画蒙太奇

站姿使用物品

**使用物品需要循环播放，因为不同的物品使用时间不同，因此需要循环播放，用逻辑控制使用时间，而不需要发送通知**

![image-20240304145812169](./.assets/image-20240304145812169.png)

蹲姿使用物品

![image-20240304145833583](./.assets/image-20240304145833583.png)

趴姿使用物品

![image-20240304145854753](./.assets/image-20240304145854753.png)

### 设置角色默认组件

1. 双击进入

   ![image-20240304150034389](./.assets/image-20240304150034389.png)
2. 三个组件

   ![](./.assets/image-20240304150858480.png)

   1. 胶囊体组件：碰撞范围
      1. 箭头组件：人物朝向
      2. 网格体组件：显示角色的骨骼模型
   2. 角色移动组件
3. 设置角色的骨骼模型

   ![image-20240304151117243](./.assets/image-20240304151117243.png)

   ![](./.assets/image-20240304151153118.png)
4. 设置胶囊体的半高为97

   ![image-20240304151516743](./.assets/image-20240304151516743.png)
5. 设置网格体

   旋转，使得绿色箭头（正方向）和浅蓝色箭头重合

   ![image-20240304151648298](./.assets/image-20240304151648298.png)
6. 调整位置

   ![image-20240304151746122](./.assets/image-20240304151746122.png)
7. 动画类旋转自己的动画

   ![image-20240304151852795](./.assets/image-20240304151852795.png)

### 创建摄像机

1. 创建一个弹簧臂组件

   当我们的摄像机碰到一个带有碰撞的几何物体时，可以自动延申摄像机的位置

   比如角色靠墙，视角会变得很近

   ![image-20240304152057097](./.assets/image-20240304152057097.png)
2. 在弹簧臂组件下添加摄像机组件

   ![image-20240304152314302](./.assets/image-20240304152314302.png)

   ![image-20240304152300370](./.assets/image-20240304152300370.png)
3. 在新窗口中运行游戏

   ![image-20240304152358236](./.assets/image-20240304152358236.png)

   ![image-20240304152456335](./.assets/image-20240304152456335.png)
4. 修改一下弹簧臂的位置也就修改了摄像机的位置

   ![image-20240304152733620](./.assets/image-20240304152733620.png)

   ![image-20240304152747033](./.assets/image-20240304152747033.png)

   可以发现位置发生了变化

### 设置输入按键

编辑-项目设置-引擎-输入

1. 删除之前的操作映射和轴映射

   ![image-20240304153008462](./.assets/image-20240304153008462.png)
2. 修改操作映射和轴映射

   ![image-20240304153901735](./.assets/image-20240304153901735.png)

   ![image-20240304153909311](./.assets/image-20240304153909311.png)

### 设置鼠标控制功能

1. 鼠标平移控制视口平移

   在MyCharacter中添加新的函数

   ![image-20240304154111318](./.assets/image-20240304154111318.png)
2. 添加函数，修改参数

   ![image-20240304154239806](./.assets/image-20240304154239806.png)
3. 添加控制器Yaw输入

   ![image-20240304154331492](./.assets/image-20240304154331492.png)
4. 制作鼠标响应平移事件

   ![image-20240304154415260](./.assets/image-20240304154415260.png)
5. 修改蓝图

   ![image-20240304155830266](./.assets/image-20240304155830266.png)
6. 设置视口上下移动逻辑（同上）

   ![image-20240304160055044](./.assets/image-20240304160055044.png)

   ![image-20240304160316380](./.assets/image-20240304160316380.png)

   发现只是角色的头移动，视口没动
7. 把弹簧臂摄像机设置，使用Pawn控制旋转勾选上

   ![image-20240304160504339](./.assets/image-20240304160504339.png)
8. 视口可以正常移动，但是移动是和我们鼠标移动相反

   ![image-20240304160556900](./.assets/image-20240304160556900.png)
9. 在参数上乘以相反的数

   ![image-20240304160843444](./.assets/image-20240304160843444.png)
10. 但是有一点点快，灵敏度高，×-0.5

    ![image-20240304161039432](./.assets/image-20240304161039432.png)

![image-20240304161108124](./.assets/image-20240304161108124.png)

### 角色移动基础功能

1. 在control创建函数

![image-20240304161934274](./.assets/image-20240304161934274.png)

2. 创建变量

   ![image-20240304162136801](./.assets/image-20240304162136801.png)

   AxisValue

   1：w或d

   -1：s或a

   0：什么没有按下
3. 绘制下列蓝图

   ![image-20240304163131396](./.assets/image-20240304163131396.png)
4. 设置局部变量

   ![image-20240304163141310](./.assets/image-20240304163141310.png)
5. 事件图表

   ![image-20240304163341323](./.assets/image-20240304163341323.png)

### 移动速度平滑处理

角色速度在一瞬加达到最大值，没有过渡

1. 创建一个变量，表示速度的最大值，浮点，类别为Move,默认为600

   ![image-20240304163527251](./.assets/image-20240304163527251.png)

   ![image-20240304165638895](./.assets/image-20240304165638895.png)
2. 打开MovingOnTheGround这个函数

   ![image-20240304164508136](./.assets/image-20240304164508136.png)
3. 折叠节点

   ![image-20240304164743846](./.assets/image-20240304164743846.png)
4. 修改输入

   ![image-20240304164910861](./.assets/image-20240304164910861.png)
5. ![image-20240304165029888](./.assets/image-20240304165029888.png)
6. 加入到原先的节点中

   ![image-20240304165147627](./.assets/image-20240304165147627.png)
7. 发现角色速度缓慢增加了

==2024.3.4==

### 自由视角功能的实现

alt+鼠标切换自由视角

1. 修改默认值

   打开MyCharacter修改根组件

   取消勾选

   ![image-20240305151404017](./.assets/image-20240305151404017.png)
2. 制作角色跟随鼠标旋转而旋转

   打开MyPlayerController，事件图表-tick事件是每一帧都会执行的事件

   ![image-20240305151554817](./.assets/image-20240305151554817.png)

   ![image-20240305151834111](./.assets/image-20240305151834111.png)

   可以发现角色可以根据鼠标移动而移动
3. 设置按下alt键移动鼠标可以旋转视角而不影响角色的朝向

   添加新的变量AltPressed？按下alt为true，松开为false

   我们需要得到按下alt时摄像机的旋转值，因为挂在弹簧臂上，所以获取的是弹簧臂的旋转值

   ![image-20240305152929113](./.assets/image-20240305152929113.png)
4. 在原来的鼠标视角转动下设置没有按下alt键时，是跟随鼠标移动视角

   ![image-20240305152805919](./.assets/image-20240305152805919.png)
5. 设置松开alt键时能够还原到原来的方向

   使得时间轴从开始处播放

   ![image-20240305153321377](./.assets/image-20240305153321377.png)
6. 点击时间轴，更名，修改长度，轨道上添加关键点

   ![image-20240305153510602](./.assets/image-20240305153510602.png)

   设置两个关键点 （0 0 ）（0.3 1）

   ![image-20240305153649225](./.assets/image-20240305153649225.png)

   选择用户，调整曲线先快后慢

   ![image-20240305153744871](./.assets/image-20240305153744871.png)

   ![image-20240305155238726](./.assets/image-20240305155238726.png)
7. 修改事件图表

   ![image-20240305155342432](./.assets/image-20240305155342432.png)
8. 发现鼠标可以控制视角移动，按住alt可以进行视角的切换并且松开alt可以恢复到原来的视角

### 优化自由视角与角色的移动

移动时按住alt键查看会有bug，角色移动的方向为视口的方向，应该是角色本来的移动方向

1. 在MyPlayerController中找到函数MovingOnTheGround

   ![image-20240305155718534](./.assets/image-20240305155718534.png)
2. 新建输入参数

   ![image-20240305155838835](./.assets/image-20240305155838835.png)

   ![image-20240305155933596](./.assets/image-20240305155933596.png)
3. 回到事件图表，找到键盘移动事件，在移动之前判断alt是否按下

   添加函数，进入函数

   ![image-20240305160327215](./.assets/image-20240305160327215.png)

   添加返回值勾选纯函数，添加局部变量

   ![image-20240305160549769](./.assets/image-20240305160549769.png)

   ![image-20240305160614771](./.assets/image-20240305160614771.png)

   ![image-20240305160827252](./.assets/image-20240305160827252.png)
4. 事件图表

   ![image-20240305160927280](./.assets/image-20240305160927280.png)

### 地面上姿势切换功能

![image-20240305161755209](./.assets/image-20240305161755209.png)

**逻辑**：输入c，如果此时是趴下，那么设置趴下为false 设置蹲为true

如果此时不是趴下，如果此时是蹲下，那么设置蹲为false

如果此时不是蹲下，那么设置蹲为true

![image-20240305162201711](./.assets/image-20240305162201711.png)

**趴下的时候瞄准状态是要关闭的**

![image-20240305162938783](./.assets/image-20240305162938783.png)

**跳跃功能**

![image-20240305163437436](./.assets/image-20240305163437436.png)

### 姿势切换限制

蹲姿和趴姿切换时是不能移动的，不能移动的时间，是过渡动画播放的时间

1. 在Blueprents创建文件夹Datas/DataTable  TableStructure

   ![image-20240305164353143](./.assets/image-20240305164353143.png)
2. 创建结构

   ![image-20240305164432323](./.assets/image-20240305164432323.png)

   ![image-20240305164513012](./.assets/image-20240305164513012.png)
3. 设置变量Sec，表示过渡动画播放所需要的秒数

   ![image-20240305164605694](./.assets/image-20240305164605694.png)
4. 在DataTable中创建数据表

   ![image-20240305164700458](./.assets/image-20240305164700458.png)

   选取结构为

   ![image-20240305164737302](./.assets/image-20240305164737302.png)

   命名为DT_ProneTime
5. 添加一行数据

   ![image-20240305164842984](./.assets/image-20240305164842984.png)
6. 修改sec时间为1.266667

   ![image-20240305165057969](./.assets/image-20240305165057969.png)
7. 修改所有与蹲姿有关的动画sec

   ![image-20240305165441500](./.assets/image-20240305165441500.png)
8. 在MyPlayer中创建变量EableMove表示当前角色是否可以移动

   ![image-20240305165630762](./.assets/image-20240305165630762.png)

   设置默认值为true

   ![image-20240305165659715](./.assets/image-20240305165659715.png)
9. 移动前判断当前是否可以移动

   ![image-20240305165838979](./.assets/image-20240305165838979.png)
10. 创建宏，用于在一段时间内控制角色移动

    ![image-20240305165914947](./.assets/image-20240305165914947.png)
11. 修改宏函数

    ![image-20240305172156777](./.assets/image-20240305172156777.png)

    拼接字符串，通过输入的状态比如 false_prone_crouch 去表中查返回时间
12. 找到了就设置禁止移动，sec后允许移动

    ![image-20240305170629205](./.assets/image-20240305170629205.png)
13. 添加宏

    ![image-20240305170859849](./.assets/image-20240305170859849.png)
14. 将各种与趴相关的宏添加进去

    ![image-20240305172624322](./.assets/image-20240305172624322.png)

### 俯仰角限制

1. 创建函数

   输入轴值，返回bool值，返回是否在范围内

   ![image-20240305173222111](./.assets/image-20240305173222111.png)
2. 创建局部变量

   表示角色向下看的值和向上看的值

   ![image-20240305173725040](./.assets/image-20240305173725040.png)

![image-20240305174710219](./.assets/image-20240305174710219.png)

![image-20240305174719179](./.assets/image-20240305174719179.png)

3. 修改鼠标移动

   ![image-20240305175702408](./.assets/image-20240305175702408.png)
4. 在增加旋转值之前，先判断是否已经超出了限制，如果超出了，就设置为边界值

   ![image-20240305180921138](./.assets/image-20240305180921138.png)

**到这里，发现一个bug，蹲下转为趴下状态，会先站起来，然后再趴下**

观察到，蹲下转为趴下，会在IsCrouching 为True的情况下，同时把IsProne改为True 把 IsCrouching改为false

![image-20240305182308115](./.assets/image-20240305182308115.png)

再查看状态机

![image-20240305182405946](./.assets/image-20240305182405946.png)

应该是先趴下，再取消蹲下，同时修改就会出现先站起来，再趴下的错误

因此我加入一个延时，先趴下，然后再取消蹲下

![image-20240305182903489](./.assets/image-20240305182903489.png)

发现并没有改变

于是我决定修改状态机，从蹲姿到趴姿

![image-20240305183305447](./.assets/image-20240305183305447.png)

这个过程我需要蹲姿为false趴姿为true才可以，显然以前写的没有蹲姿为false

![image-20240305183426297](./.assets/image-20240305183426297.png)

但是还不行，最后修改

从蹲到站，趴和蹲都是false才可以

![image-20240305184258402](./.assets/image-20240305184258402.png)

成功了，持枪状态也修改一下

这个bug完美解决了！！真棒！

### 计算摄像机的高度值

和上面一样，创建结构

1. 创建结构

   保存摄像机在角色不同位置时候的数据

   ![image-20240305185045771](./.assets/image-20240305185045771.png)

   ![image-20240305185053258](./.assets/image-20240305185053258.png)
2. 创建数据表

   ![image-20240305185214007](./.assets/image-20240305185214007.png)

   ![image-20240305185233119](./.assets/image-20240305185233119.png)
3. 打开MyPlayerController

   添加移动摄像机所需要的变量

   ![image-20240305185406721](./.assets/image-20240305185406721.png)
4. 键盘移动事件

   ![image-20240305185523335](./.assets/image-20240305185523335.png)
5. 添加新的变量

   ![image-20240305185654689](./.assets/image-20240305185654689.png)

   表示摄像机实时的高度

   ![image-20240305185721272](./.assets/image-20240305185721272.png)

   默认值
6. 新变量，表示摄像机的目标高度值和摄像机高度变动前的起点值

   ![image-20240305185939516](./.assets/image-20240305185939516.png)
7. 自定义事件

   ![image-20240305190110174](./.assets/image-20240305190110174.png)
8. 创建变量

   ![image-20240305190303994](./.assets/image-20240305190303994.png)

   ![image-20240305190438385](./.assets/image-20240305190438385.png)
9. ![image-20240305191709090](./.assets/image-20240305191709090.png)

### 设置摄像机的高度值

![image-20240305193104621](./.assets/image-20240305193104621.png)

1. 找到蹲姿切换

   ![image-20240305193216613](./.assets/image-20240305193216613.png)
2. 趴也是

   ![image-20240305193240793](./.assets/image-20240305193240793.png)
3. 跳也是

   ![image-20240305193348460](./.assets/image-20240305193348460.png)
4. 键盘移动

   ![image-20240305195433960](./.assets/image-20240305195433960.png)

### 设置不同姿势对应不同速度值的数据表

![](./.assets/image-20240305195718059.png)

![image-20240305195653246](./.assets/image-20240305195653246.png)

![image-20240305195830209](./.assets/image-20240305195830209.png)

![image-20240305195841264](./.assets/image-20240305195841264.png)

![image-20240305195943561](./.assets/image-20240305195943561.png)

![image-20240305200005314](./.assets/image-20240305200005314.png)

### 通过角色姿势和状态设置速度值

![image-20240305200539380](./.assets/image-20240305200539380.png)

创建更新速度的函数

![image-20240305202135577](./.assets/image-20240305202135577.png)

在角色移动之前调用函数

![image-20240305202346393](./.assets/image-20240305202346393.png)

### 创建子骨骼模型

将骨骼拆分出来，贴图合成

1. 在网格体中添加新的骨骼体网格组件

   ![image-20240305214201540](./.assets/image-20240305214201540.png)
2. 创建下图所示

   ![image-20240305214558373](./.assets/image-20240305214558373.png)
3. 设置SKM_Hair

   ![image-20240305214652457](./.assets/image-20240305214652457.png)
4. 创建函数，初始化角色的骨骼模型

   ![image-20240305214859194](./.assets/image-20240305214859194.png)
5. 蒙皮

   ![image-20240305215409533](./.assets/image-20240305215409533.png)
6. 设置主姿势

   ![image-20240305215755320](./.assets/image-20240305215755320.png)
7. 附加头发

   ![image-20240305215953293](./.assets/image-20240305215953293.png)
8. 在构造脚本中运行函数

   ![image-20240305220024280](./.assets/image-20240305220024280.png)
9. 调整头发位置

   ![image-20240305220430027](./.assets/image-20240305220430027.png)

### 准备时装数据

1. 创建文件夹

   ![image-20240305220533910](./.assets/image-20240305220533910.png)
2. 创建枚举文件

   ![image-20240305220744349](./.assets/image-20240305220744349.png)
3. ![image-20240305220824514](./.assets/image-20240305220824514.png)
4. TableStructure

   ![image-20240305221131873](./.assets/image-20240305221131873.png)

   ![image-20240305221107194](./.assets/image-20240305221107194.png)
5. DataTable Item

   添加衣服

   ![image-20240305221325404](./.assets/image-20240305221325404.png)

   ![image-20240305221444890](./.assets/image-20240305221444890.png)

### 替换骨骼网格体模型

1. MyCharacter中创建函数

   ![image-20240305221757645](./.assets/image-20240305221757645.png)
2. 设置函数

   ![image-20240305222453263](./.assets/image-20240305222453263.png)

   ![image-20240305222539624](./.assets/image-20240305222539624.png)
3. ![image-20240305222916154](./.assets/image-20240305222916154.png)

### 连体衣特殊处理

![image-20240305224130487](./.assets/image-20240305224130487.png)

### 设置皮肤遮罩

防止衣服穿模

==2024.3.4==

1. 找到这个

   ![image-20240306095503603](./.assets/image-20240306095503603.png)
2. 这边设置什么遮罩，穿衣服就不会穿模

   ![image-20240306095729885](./.assets/image-20240306095729885.png)
3. 设置连体衣遮罩

   ![image-20240306095852758](./.assets/image-20240306095852758.png)
4. 在时装数据表中添加遮罩资源

   ![image-20240306100047599](./.assets/image-20240306100047599.png)
5. 添加衣服遮罩

   ![image-20240306100150619](./.assets/image-20240306100150619.png)
6. 后面的都要添加

   ![image-20240306100217203](./.assets/image-20240306100217203.png)
7. 函数添加新的输出变量

   ![image-20240306100304872](./.assets/image-20240306100304872.png)

   ![image-20240306100445177](./.assets/image-20240306100445177.png)
8. ReplaceSkeletaMesh 根据不同的骨骼模型设置不同的遮罩

   ![image-20240306101100634](./.assets/image-20240306101100634.png)
9. ![image-20240306101109549](./.assets/image-20240306101109549.png)

### 优化皮肤遮罩

![image-20240306102539314](./.assets/image-20240306102539314.png)

### 设置角色默认着装

![image-20240306103140745](./.assets/image-20240306103140745.png)

**穿脱鞋子需要重新设置角色高度**

![image-20240306104617228](./.assets/image-20240306104617228.png)

### 制作武器数据结构

1. 新建ST

   ![image-20240306104803150](./.assets/image-20240306104803150.png)
2. 设置变量

   ![image-20240306104839512](./.assets/image-20240306104839512.png)

### 制作武器数据表格

![image-20240306104935530](./.assets/image-20240306104935530.png)

![image-20240306105009552](./.assets/image-20240306105009552.png)

### 制作子弹数据表

![image-20240306105140371](./.assets/image-20240306105140371.png)

![image-20240306105147677](./.assets/image-20240306105147677.png)

![image-20240306105312370](./.assets/image-20240306105312370.png)

![image-20240306105320200](./.assets/image-20240306105320200.png)

### 制作武器配件数据表

![image-20240306105542028](./.assets/image-20240306105542028.png)

![image-20240306105656761](./.assets/image-20240306105656761.png)

![image-20240306105726506](./.assets/image-20240306105726506.png)

![image-20240306105735309](./.assets/image-20240306105735309.png)

![image-20240306105806355](./.assets/image-20240306105806355.png)

![image-20240306105820077](./.assets/image-20240306105820077.png)

### 制作装备数据表

![image-20240306105857239](./.assets/image-20240306105857239.png)

![image-20240306105904040](./.assets/image-20240306105904040.png)

![image-20240306105933248](./.assets/image-20240306105933248.png)

![image-20240306105939798](./.assets/image-20240306105939798.png)

![image-20240306105949734](./.assets/image-20240306105949734.png)

![image-20240306110000124](./.assets/image-20240306110000124.png)

### 制作药品数据表

直接恢复生命值

![image-20240306110051396](./.assets/image-20240306110051396.png)

![image-20240306110057248](./.assets/image-20240306110057248.png)

![image-20240306110109464](./.assets/image-20240306110109464.png)

![image-20240306110115345](./.assets/image-20240306110115345.png)

能量

![image-20240306110152769](./.assets/image-20240306110152769.png)

![image-20240306110159411](./.assets/image-20240306110159411.png)

![image-20240306110212215](./.assets/image-20240306110212215.png)

![image-20240306110217897](./.assets/image-20240306110217897.png)

### 物品架构介绍

![image-20240306110245872](./.assets/image-20240306110245872.png)

### 创建物品基类

![image-20240306110617332](./.assets/image-20240306110617332.png)

![image-20240306110655727](./.assets/image-20240306110655727.png)

1. 新建场景组件

![image-20240306110718084](./.assets/image-20240306110718084.png)

2. 物品类型

   ![image-20240306111100420](./.assets/image-20240306111100420.png)

   ![image-20240306110759036](./.assets/image-20240306110759036.png)

   ID 物品的ID  物品编号

   SN 物品唯一的编号

   Name 物品的名称

   Amout 物品的数量

   CharacterRef MyCharacter 对象的引用

   ControllerRef MyPlayerController对象的引用

   ![image-20240306111040171](./.assets/image-20240306111040171.png)

   ID SN Amount
3. 初始化对象引用

   ![image-20240306111346960](./.assets/image-20240306111346960.png)
4. 创建函数
5. 初始化

   ![image-20240306111432154](./.assets/image-20240306111432154.png)

   ![image-20240306111446461](./.assets/image-20240306111446461.png)

   ![image-20240306111501784](./.assets/image-20240306111501784.png)

   ![image-20240306111517878](./.assets/image-20240306111517878.png)

   获取物品重量

   ![image-20240306111533322](./.assets/image-20240306111533322.png)

![image-20240306111610414](./.assets/image-20240306111610414.png)

实时更新物品数量

![image-20240306111714980](./.assets/image-20240306111714980.png)

### 创建拾取对象基类

1. 新建文件夹PickUp

   ![image-20240312182809036](./.assets/image-20240312182809036.png)
2. 拾取前地面物品的基类

   ![image-20240312182908481](./.assets/image-20240312182908481.png)
3. 类设置为所有物品的基类 ItemBase

   ![image-20240312183030755](./.assets/image-20240312183030755.png)
4. 创建UI和Outline

   ![image-20240312183240702](./.assets/image-20240312183240702.png)

   UI文件

   Outline 使得物体高亮的文件

   Box 用于与角色进行碰撞检测
5. 创建变量

   ![image-20240312183404893](./.assets/image-20240312183404893.png)

   物品拾取的名字前缀
6. 将StaticMesh和Outline的碰撞预设设置为无碰撞

   ![image-20240312183527077](./.assets/image-20240312183527077.png)
7. 创建函数InitPickup 初始化拾取功能

   ![image-20240312183630959](./.assets/image-20240312183630959.png)

   ![image-20240312183706219](./.assets/image-20240312183706219.png)

   ![image-20240312183816603](./.assets/image-20240312183816603.png)
8. 为了方便查看效果，给StaticMesh添加一个模型

   ![image-20240312183959775](./.assets/image-20240312183959775.png)

   视口发现静态网格体有模型

   ![image-20240312184047398](./.assets/image-20240312184047398.png)
9. 修改碰撞预设的对象通道，打开项目设置

   ![image-20240313101240966](./.assets/image-20240313101240966.png)
10. 修改地面的碰撞预设

    ![image-20240313101417217](./.assets/image-20240313101417217.png)
11. 修改事件图表

    ![image-20240313101738456](./.assets/image-20240313101738456.png)

    逻辑：物体由起始位置向终点位置发射一条射线，如果发生碰撞，那么就重新修改物体的位置为新的值
12. 设置角色与物体的碰撞

    设置盒体的范围

    ![image-20240313102350585](./.assets/image-20240313102350585.png)

    ![image-20240313102507366](./.assets/image-20240313102507366.png)

    添加事件开始重叠时和事件结束重叠时

    ![image-20240313102549390](./.assets/image-20240313102549390.png)

    ![image-20240313102602410](./.assets/image-20240313102602410.png)

    逻辑：当组件重叠时，一个actor是我们的角色，就调用事件 On Begin Overlap

    当组件结束重叠时，一个actor是我们的角色，就调用事件 On End Overlap
13. 放置actor重命名，并且修改渲染

    ![image-20240313103200669](./.assets/image-20240313103200669.png)

    ![image-20240313103240506](./.assets/image-20240313103240506.png)

    ![image-20240313103305444](./.assets/image-20240313103305444.png)
14. 在Pickup函数中创建新的函数EnableOutline

    用来表示是否开启高亮

    ![image-20240313103356360](./.assets/image-20240313103356360.png)

### 创建武器拾取对象基类

1. 创建蓝图

   ![image-20240313103811968](./.assets/image-20240313103811968.png)

   类设置父类

   ![image-20240313104005006](./.assets/image-20240313104005006.png)

   添加变量，记录武器子弹数量

   ![image-20240313104058325](./.assets/image-20240313104058325.png)
2. 修改构造函数

   ![image-20240313104549722](./.assets/image-20240313104549722.png)
3. 测试

### 创建武器配件拾取对象

![image-20240313105645978](./.assets/image-20240313105645978.png)

![image-20240313105704292](./.assets/image-20240313105704292.png)

![image-20240313105728476](./.assets/image-20240313105728476.png)

获取配件并调整放置的角度

![image-20240313110019815](./.assets/image-20240313110019815.png)

![image-20240313110644791](./.assets/image-20240313110644791.png)

获取重量

![image-20240313110717615](./.assets/image-20240313110717615.png)

打开关卡蓝图测试

![image-20240313111143001](./.assets/image-20240313111143001.png)

配件正确生成

![image-20240313111215785](./.assets/image-20240313111215785.png)

### 创建子弹拾取对象

![image-20240313111400369](./.assets/image-20240313111400369.png)

![image-20240313111419571](./.assets/image-20240313111419571.png)

构造脚本

![image-20240313111440529](./.assets/image-20240313111440529.png)

get weight

![image-20240313111624439](./.assets/image-20240313111624439.png)

![image-20240313111704811](./.assets/image-20240313111704811.png)

子弹正确生成

### 创建装备拾取对象

![image-20240313111725005](./.assets/image-20240313111725005.png)

![image-20240313111804623](./.assets/image-20240313111804623.png)

![image-20240313111816461](./.assets/image-20240313111816461.png)

![image-20240313111831385](./.assets/image-20240313111831385.png)

事件图表

![image-20240313111858579](./.assets/image-20240313111858579.png)

防弹衣和头盔都正常生成

![image-20240313112108565](./.assets/image-20240313112108565.png)

### 创建药品拾取对象

![image-20240313112211898](./.assets/image-20240313112211898.png)

![image-20240313112223449](./.assets/image-20240313112223449.png)

![image-20240313112232984](./.assets/image-20240313112232984.png)

![image-20240313112330597](./.assets/image-20240313112330597.png)

### 创建药剂拾取对象

![image-20240313112404697](./.assets/image-20240313112404697.png)

![image-20240313112414206](./.assets/image-20240313112414206.png)

![image-20240313112425204](./.assets/image-20240313112425204.png)

![image-20240313112456776](./.assets/image-20240313112456776.png)

### 创建时装拾取对象

![image-20240313112531110](./.assets/image-20240313112531110.png)

![image-20240313112546028](./.assets/image-20240313112546028.png)

![image-20240313112557376](./.assets/image-20240313112557376.png)

### 武器骨骼插槽

骨骼插槽是特殊绑定点，与其他模型进行绑定

1. 添加数据表格

   ![image-20240313112908002](./.assets/image-20240313112908002.png)

   ![image-20240306112530939](./.assets/image-20240306112530939.png)

   ![image-20240306112622483](./.assets/image-20240306112622483.png)
2. 打开数据表，修改名称

   ![image-20240313112956475](./.assets/image-20240313112956475.png)

![image-20240313113031826](./.assets/image-20240313113031826.png)

### 创建武器配件物品对象

所有装备物品对象都在这里面

![image-20240313113126178](./.assets/image-20240313113126178.png)

![image-20240313113205223](./.assets/image-20240313113205223.png)

![image-20240313113222693](./.assets/image-20240313113222693.png)

![image-20240313113234209](./.assets/image-20240313113234209.png)

存储武器配件数据

![image-20240313113333240](./.assets/image-20240313113333240.png)

![image-20240313113341233](./.assets/image-20240313113341233.png)

### 创建武器物品对象

![image-20240313113532694](./.assets/image-20240313113532694.png)

1. 添加组件

   ![image-20240313113653614](./.assets/image-20240313113653614.png)

   mag 弹夹

   muzzle 枪嘴

   sight 瞄准镜

   foregrip 握把

   buttstock 枪托

   audio 声音

   fireflash 粒子特效
2. 都设置为无碰撞

   ![image-20240313113906158](./.assets/image-20240313113906158.png)
3. 创建变量

   ![image-20240313113929026](./.assets/image-20240313113929026.png)
4. 创建枚举

   ![image-20240313114003951](./.assets/image-20240313114003951.png)

   ![image-20240313114015104](./.assets/image-20240313114015104.png)

   ![image-20240313114634088](./.assets/image-20240313114634088.png)
5. 在MyCharacter中的事件图表，按下1键生成武器

   ![image-20240313114534355](./.assets/image-20240313114534355.png)

   ![image-20240313114601890](./.assets/image-20240313114601890.png)

### 创建武器物品对象的声音和粒子组件

1. 武器声音有消音器和没消音器两种

   ![image-20240313114823400](./.assets/image-20240313114823400.png)
2. 修改MyCharacter

   ![image-20240313115227979](./.assets/image-20240313115227979.png)
3. 创建粒子特效

   ![image-20240313115440301](./.assets/image-20240313115440301.png)
4. 修改构造函数

   ![image-20240313115455892](./.assets/image-20240313115455892.png)
5. 修改粒子特效缩放

   ![image-20240313115609302](./.assets/image-20240313115609302.png)

### 创建子弹和装备的物品对象

![image-20240313115652485](./.assets/image-20240313115652485.png)

![image-20240313115722198](./.assets/image-20240313115722198.png)

![image-20240313115733951](./.assets/image-20240313115733951.png)

![image-20240313115801794](./.assets/image-20240313115801794.png)

![image-20240313115820029](./.assets/image-20240313115820029.png)

### 创建使用类型和时装的物品对象

![image-20240313115918398](./.assets/image-20240313115918398.png)

所有可以被使用的物品

1. 设置使用基类

   ![image-20240313115948384](./.assets/image-20240313115948384.png)

   ![image-20240313120005574](./.assets/image-20240313120005574.png)

   ![image-20240313120014827](./.assets/image-20240313120014827.png)
2. 创建使用药品

   ![image-20240313120041113](./.assets/image-20240313120041113.png)

   ![image-20240313120049158](./.assets/image-20240313120049158.png)

   ![image-20240313120058351](./.assets/image-20240313120058351.png)
3. 创建使用药剂

   ![image-20240313120111184](./.assets/image-20240313120111184.png)

   ![image-20240313120122593](./.assets/image-20240313120122593.png)
4. 创建使用时装

   ![image-20240313120226391](./.assets/image-20240313120226391.png)

### 物品生成规则

![image-20240306112716678](./.assets/image-20240306112716678.png)

![image-20240306112730067](./.assets/image-20240306112730067.png)

### 制作概率相关数据表

![image-20240306112913606](./.assets/image-20240306112913606.png)

    ![image-20240306113014060](./.assets/image-20240306113014060.png)

![image-20240306113024518](./.assets/image-20240306113024518.png)

![image-20240306113051921](./.assets/image-20240306113051921.png)

![image-20240306113112699](./.assets/image-20240306113112699.png)

![image-20240306113122909](./.assets/image-20240306113122909.png)

![image-20240306113129458](./.assets/image-20240306113129458.png)

武器数据结构添加

![image-20240306113221473](./.assets/image-20240306113221473.png)

设置武器出现的概率40

![image-20240306113301657](./.assets/image-20240306113301657.png)

对子弹同理

![image-20240306113338957](./.assets/image-20240306113338957.png)

药品装备配件都是

![image-20240306113427094](./.assets/image-20240306113427094.png)

### 创建物品组

新建一个actor

![image-20240306113616390](./.assets/image-20240306113616390.png)

![image-20240306113652171](./.assets/image-20240306113652171.png)

添加五个模型文件

![image-20240306113706265](./.assets/image-20240306113706265.png)

摆放五个物品的位置

![image-20240306113835523](./.assets/image-20240306113835523.png)

创建新的函数吗，获取位置变换

![image-20240306113853722](./.assets/image-20240306113853722.png)

![image-20240306113922283](./.assets/image-20240306113922283.png)

![image-20240306113928260](./.assets/image-20240306113928260.png)

![image-20240306113952558](./.assets/image-20240306113952558.png)

![image-20240306114242938](./.assets/image-20240306114242938.png)

![image-20240306114250126](./.assets/image-20240306114250126.png)

![image-20240306114306068](./.assets/image-20240306114306068.png)

![image-20240313120851706](./.assets/image-20240313120851706.png)

### 随机数量

1. 打开MyGameMode

![image-20240306114548194](./.assets/image-20240306114548194.png)

2. 两个函数

   ![image-20240313123911483](./.assets/image-20240313123911483.png)

   ![image-20240313123858951](./.assets/image-20240313123858951.png)

### 随机物品类型

1. 创建函数RandomItemtype

    ![image-20240314153544737](./.assets/image-20240314153544737.png)

2. 修改GenerateItems

    ![image-20240314153935977](./.assets/image-20240314153935977.png)

3. 测试

    ![image-20240314155236432](./.assets/image-20240314155236432.png)

    ![image-20240314155248442](./.assets/image-20240314155248442.png)

4. 显示随机物品名称

    ![image-20240314155310024](./.assets/image-20240314155310024.png)





### 随机物品编号



1. 创建新的结构体

    ![image-20240314155518359](./.assets/image-20240314155518359.png)

    ![image-20240314155527314](./.assets/image-20240314155527314.png)

    

2. 创建函数RandomItemID

    ![image-20240314163516329](./.assets/image-20240314163516329.png)

3. 修改generateitems

    ![image-20240314163530703](./.assets/image-20240314163530703.png)



### 添加对应武器的子弹对象

1. 找到对应的武器对象

    ![image-20240321163322657](./.assets/image-20240321163322657.png)

2. 创建一个子弹对象

    ![image-20240321163335920](./.assets/image-20240321163335920.png)

3. 删除一个对象

    ![image-20240321163351145](./.assets/image-20240321163351145.png)

4. 测试

    ![image-20240321163403384](./.assets/image-20240321163403384.png)

    ![image-20240321163433985](./.assets/image-20240321163433985.png)

    

### 随机物品的生成的位置

1. 循环所有准备生成的对象

    ![image-20240321174035692](./.assets/image-20240321174035692.png)

2. 随机位置

    ![image-20240321174028990](./.assets/image-20240321174028990.png)

3. 测试，每一条都没有重复的

    ![image-20240321173942249](./.assets/image-20240321173942249.png)



==2024.3.21==

### 随机生成物品对象

1. 在MyGameInstance中新建函数，生成唯一标识SN

    ![image-20240322181124978](./.assets/image-20240322181124978.png)

2. 修改事件图表

    ![image-20240322181142659](./.assets/image-20240322181142659.png)

3. 修改GenerateItems

    ![image-20240322181209461](./.assets/image-20240322181209461.png)

4. 测试

    ![image-20240322181337850](./.assets/image-20240322181337850.png)

    

    

    

    

    

### 创建数据变量

1. 打开MyGameState 创建变量LiveAmount表示存活人数

2. 在MyPlayerState中创建对应的变量以及获取的函数

    ![image-20240322183453232](./.assets/image-20240322183453232.png)

    ![image-20240322183459993](./.assets/image-20240322183459993.png)



==2024.3.22==



3. 创建一系列函数

    ![image-20240323105629092](./.assets/image-20240323105629092.png)

    setter add remove

    ![image-20240323105652934](./.assets/image-20240323105652934.png)

    ![image-20240323105701402](./.assets/image-20240323105701402.png)

    ![image-20240323105707149](./.assets/image-20240323105707149.png)

    ![image-20240323105715111](./.assets/image-20240323105715111.png)

    ![image-20240323105723075](./.assets/image-20240323105723075.png)

    ![image-20240323105730166](./.assets/image-20240323105730166.png)

    ![image-20240323105737188](./.assets/image-20240323105737188.png)

    

​    ==2024.3.23==

4. 在GameInstance中创建插槽名称

    ![image-20240323111642245](./.assets/image-20240323111642245.png)

    只有第一个只读蓝图不勾选，估计是作者遗漏了

    ![image-20240323111654486](./.assets/image-20240323111654486.png)

    ![image-20240323111706927](./.assets/image-20240323111706927.png)



















